<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>

	<meta charset="UTF-8">
	<title>クーポンルーレット</title>
	<style>
		body {
					margin: 0;
					padding: 0;
					font-family: 'Arial', sans-serif;
					background-image: url('img/JUGGLER.jpg');
					background-size: cover;
					background-position: center;
					display: flex;
					flex-direction: column;
					align-items: center;
					/* 水平中央揃え */
					justify-content: center;
					/* 垂直中央揃え */
					height: 100vh;
					color: rgba(255, 255, 255, 0.8);
					text-align: center;
					/* テキストを中央に揃え */
				}
		
				#coupon-result {
					margin-bottom: 20px;
					/* 下に余白 */
					font-size: 3em;
					font-weight: bold;
					color: #FFF566;
					/* 文字色 */
					text-shadow:
						0 0 10px rgba(0, 0, 0, 0.8),
						/* 黒の影 */
						0 0 20px rgba(255, 255, 0, 0.8),
						/* 明るい影 */
						0 0 30px rgba(255, 0, 255, 0.8);
					/* ネオンピンクの影 */
					opacity: 0;
					/* 初期は透明 */
					transition: opacity 0.5s ease;
					/* フェードイン用 */
				}
		
				#roulette-container {
					width: 300px;
					height: 300px;
					position: relative;
					margin: 20px 0;
					/* 上下のマージン */
				}
		
				#roulette {
					width: 100%;
					height: 100%;
					border-radius: 50%;
					transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
					background: conic-gradient(from 0deg,
							#ff00ff 0deg 72deg,
							#00ff00 72deg 144deg,
							#ff6600 144deg 216deg,
							#ffff00 216deg 288deg,
							#00ffff 288deg 360deg);
					box-shadow: 0 0 20px rgba(255, 255, 255, 0.8),
						0 0 30px rgba(255, 255, 255, 0.6),
						0 0 40px rgba(255, 255, 255, 0.4);
					animation: glow 2s infinite alternate;
				}
		
				@keyframes glow {
					from {
						box-shadow: 0 0 20px rgba(255, 255, 255, 0.8),
							0 0 30px rgba(255, 255, 255, 0.6),
							0 0 40px rgba(255, 255, 255, 0.4);
					}
		
					to {
						box-shadow: 0 0 40px rgba(255, 255, 255, 0.8),
							0 0 50px rgba(255, 255, 255, 0.6),
							0 0 60px rgba(255, 255, 255, 0.4);
					}
				}
		
				.coupon-item {
					position: absolute;
					top: 0;
					right: 50%;
					transform-origin: 100% 100%;
					width: 50%;
					height: 50%;
					display: flex;
					align-items: center;
					justify-content: center;
					box-sizing: border-box;
					color: white;
					font-weight: bold;
					text-shadow: 0 0 5px rgba(0, 0, 0, 0.8),
						0 0 10px rgba(255, 255, 255, 0.8);
					font-size: 14px;
					text-align: center;
					padding: 0 5px;
				}
		
				.arrow {
					position: absolute;
					top: -30px;
					left: 50%;
					transform: translateX(-50%);
					width: 0;
					height: 0;
					border-left: 20px solid transparent;
					border-right: 20px solid transparent;
					border-top: 30px solid #333;
				}
		
				button {
					margin-top: 20px;
					padding: 10px 20px;
					font-size: 1.2em;
					cursor: pointer;
					background-color: #ff00ff;
					border: none;
					border-radius: 5px;
					color: white;
					text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
					box-shadow: 0 0 10px rgba(255, 0, 255, 0.8);
					transition: all 0.3s ease;
				}
		
				button:hover {
					background-color: #ff66ff;
					box-shadow: 0 0 20px rgba(255, 0, 255, 0.8);
				}
		
				@keyframes rainbow {
					0% {
						color: #ff0000;
					}
		
					14% {
						color: #ff7f00;
					}
		
					28% {
						color: #ffff00;
					}
		
					42% {
						color: #00ff00;
					}
		
					57% {
						color: #0000ff;
					}
		
					71% {
						color: #8b00ff;
					}
		
					85% {
						color: #ff00ff;
					}
		
					100% {
						color: #ff0000;
					}
				}
		
				.rainbow-text {
					animation: rainbow 6s linear infinite;
				}
		
				#coupon-result {
					margin-bottom: 20px;
					font-weight: bold;
					text-shadow:
						0 0 10px rgb(255, 128, 192),
						0 0 50px rgb(128, 0, 255),
						0 0 30px rgb(255, 255, 128)(255, 255, 255, 0.8);
					opacity: 0;
				}
		
				.wave-text {
					display: inline-block;
					font-size: 3em;
					color: greenyellow;
					/* 文字色 */
					animation: wave 1s infinite;
				}
		
				@keyframes wave {
		
					0%,
					100% {
						transform: translateY(0);
					}
		
					50% {
						transform: translateY(-10px);
					}
				}

        #roulette-container {
            width: 300px;
            height: 300px;
            position: relative;
            margin: 20px auto;
        }
       
        .coupon-item {
            position: absolute;
            top: 0;
            right: 50%;
            transform-origin: 100% 100%;
            width: 50%;
            height: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            font-size: 14px;
            text-align: center;
            padding: 0 10px;
        }
        .arrow {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 30px solid #333;
        }
        #coupon-result {
            margin-top: 20px;
            font-size: 2em;
            font-weight: bold;
            color: green;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
        }
    </style>

</head>

<body>
	
	<div id="coupon-result">
		<span class="wave-text"></span>
	</div>

    <div id="roulette-container">
        <div id="roulette">
            <div class="coupon-item" data-coupon="COUPON_TYPE1" style="transform: rotate(0deg)">半額</div>
            <div class="coupon-item" data-coupon="COUPON_TYPE2" style="transform: rotate(288deg)">1000円引き</div>
            <div class="coupon-item" data-coupon="COUPON_TYPE3" style="transform: rotate(216deg)">ドリンク１杯無料</div>
            <div class="coupon-item" data-coupon="COUPON_TYPE4" style="transform: rotate(144deg)">席料 無料</div>
            <div class="coupon-item" data-coupon="MISS" style="transform: rotate(72deg)">はずれ</div>
        </div>
        <div class="arrow"></div>

    </div>

    <div id="coupon-result"></div>
    <button id="spin-button" onclick="startRoulette()">ルーレットを回す</button>
    <button id="view-coupon-button" style="display:none;" onclick="viewCoupon()">獲得したクーポンを見る</button>
    <button id="back-to-list-button" style="display:none;" onclick="backToList()">クーポン一覧に戻る</button>


    <audio id="roulette-sound">
        <source src="/audio/SE114.mp3" type="audio/mpeg">
        お使いのブラウザは音声タグに対応していません。
    </audio>

    <script>
        let totalRotation = 0;
        let couponType = ''; // クーポンタイプを保持
        let coupon = null; // couponオブジェクトを保持する変数

        function startRoulette() {
            const spinButton = document.getElementById('spin-button');
            const viewButton = document.getElementById('view-coupon-button');
            const backToListButton = document.getElementById('back-to-list-button');


            spinButton.style.display = 'none';
            viewButton.style.display = 'none';
            backToListButton.style.display = 'none';



            fetch('/couponcreate')
                .then(response => response.json())
                .then(data => {
                    couponType = data.couponType; // 受け取ったクーポンタイプを設定
                    coupon = data.coupon; // couponオブジェクトを保持



                    const targetRotation = calculateTargetRotation(couponType);
                    const additionalRotation = 1440 + targetRotation; // 1440度回転させる
                    totalRotation += additionalRotation;

                    const roulette = document.getElementById('roulette');
                    roulette.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
                    roulette.style.transform = `rotate(${totalRotation}deg)`;

                    setTimeout(() => {
                        if (couponType === null) {
                            displayResult('MISS');
                            backToListButton.style.display = 'block';
                        } else {
                            displayResult(couponType);
                            viewButton.style.display = 'block';
                        }
                    }, 5000);
                })
                .catch(error => {
                    console.error('Error fetching coupon:', error);
                    spinButton.style.display = 'block'; // エラー時にボタンを再表示
                });

            const sound = document.getElementById('roulette-sound');
            sound.currentTime = 0;
            sound.play();
        }



        function backToList() {
            window.location.href = '/couponlist'; // クーポン一覧に戻る
        }

        function calculateTargetRotation(couponType) {
            let min, max;

            switch (couponType) {
                case 'COUPON_TYPE1':
                    min = 1; max = 71;
                    break;
                case 'COUPON_TYPE2':
                    min = 73; max = 143;
                    break;
                case 'COUPON_TYPE3':
                    min = 145; max = 215;
                    break;
                case 'COUPON_TYPE4':
                    min = 217; max = 287;
                    break;
                case 'MISS':
                default:
                    min = 289; max = 359;
                    break;
            }

            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function displayResult(couponType) {
            const result = document.getElementById('coupon-result');
            let couponMessage;

            switch (couponType) {
                case 'COUPON_TYPE1':
                    couponMessage = "半額のクーポンを獲得しました！";
                    break;
                case 'COUPON_TYPE2':
                    couponMessage = "1000円引きのクーポンを獲得しました！";
                    break;
                case 'COUPON_TYPE3':
                    couponMessage = "ドリンク１杯無料のクーポンを獲得しました！";
                    break;
                case 'COUPON_TYPE4':
                    couponMessage = "席料無料のクーポンを獲得しました！";
                    break;
                default:
                    couponMessage = "残念ですが、はずれです";
                    break;
            }

            result.innerText = couponMessage;
        }

        function viewCoupon() {
            const couponIdMap = {
                'COUPON_TYPE1': 1,
                'COUPON_TYPE2': 2,
                'COUPON_TYPE3': 3,
                'COUPON_TYPE4': 4,
                'MISS': 0 // はずれの場合のID
            };
            const couponId = couponIdMap[couponType];
            window.location.href = `/couponresult?id=${couponId}`; // 取得したクーポンを表示する
        }
    </script>

</body>

</html>
